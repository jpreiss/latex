\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{jpmath}

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathtools}
\RequirePackage{nicefrac}
\RequirePackage{physics}
\RequirePackage{siunitx}
\RequirePackage{mathrsfs} % mathscr font

% Make the penalty for breaking inline math across lines much higher.
% Override in particular equations by inserting \allowbreak.
\binoppenalty=9999
\relpenalty=9999

% Black magic from StackExchange.
% Defines mathcal macros such that \cA = \mathcal{A}, and so on.
\def\mydefc#1{\expandafter\def\csname c#1\endcsname{\mathcal{#1}}}
\def\mydefallc#1{\ifx#1\mydefallc\else\mydefc#1\expandafter\mydefallc\fi}
\mydefallc ABCDEFGHIJKLMNOPQRSTUVWXYZ\mydefallc
% Defines bold macros such that \ba = \mathbf{a}, and so on.
\def\mydefb#1{\expandafter\def\csname b#1\endcsname{\mathbf{#1}}}
\def\mydefallb#1{\ifx#1\mydefallb\else\mydefb#1\expandafter\mydefallb\fi}
\mydefallb abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\mydefallb

% Sets of numbers.
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}  % Generic field.
\newcommand{\Rpos}{\R_{> 0}}
\newcommand{\Rnonneg}{\R_{\geq 0}}

% Common sets.
\newcommand{\ball}{\cB}
\newcommand{\PSD}[1]{\mathbb{S}_+^{#1}}
\newcommand{\PD}[1]{\mathbb{S}_{++}^{#1}}
\newcommand{\Rnn}{\R^{n \times n}}
\newcommand{\Rnm}{\R^{n \times m}}
\newcommand{\Rmn}{\R^{m \times n}}

% Matrix groups and Lie algebras.
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\SO}{\mathrm{SO}}
\newcommand{\SE}{\mathrm{SE}}
\newcommand{\so}{\mathfrak{so}}
\newcommand{\se}{\mathfrak{se}}

% Bold and blackboard symbols.
\newcommand{\one}{\mathbf{1}}
\newcommand{\zero}{\mathbf{0}}
\newcommand{\I}{\mathbb{I}}  % For an indicator random variable.
% Common fractions.
\newcommand{\recip}[1]{\frac{1}{#1}}
\newcommand{\half}{\recip{2}}
\newcommand{\invsqrt}[1]{\recip{\sqrt{#1}}}

% Common summations.
\newcommand{\sumin}{\sum_{i=1}^n}
\newcommand{\sumtn}{\sum_{t=1}^n}

% Logic.
\DeclareMathOperator{\suchthat}{such\ that\ }
\DeclareMathOperator{\st}{s.t.\ }
\DeclareMathOperator{\subjto}{subject\ to\ }
\DeclareMathOperator{\subjectto}{subject\ to\ }
\newcommand{\otherwise}{\mathrm{otherwise}}
\DeclareMathOperator{\foralltext}{\text{ for all } }

% Functions.
\newcommand{\invimg}[1]{{{#1}^{-1}}}
\DeclareMathOperator{\domain}{dom}
\DeclareMathOperator{\dom}{dom}

% Delimiters.
\DeclarePairedDelimiter{\inner}{\langle}{\rangle}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

% Linear algebra and matrices.
\newcommand{\T}{\top}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\Span}{span}
% TODO how to renewcommand for MathOperator
\renewcommand{\Vec}{\mathrm{Vec}}
\newcommand{\bmat}[1]{\begin{bmatrix} #1 \end{bmatrix}}
\newcommand{\bsmallmat}[1]{\begin{bsmallmatrix} #1 \end{bsmallmatrix}}
\renewcommand{\pmat}[1]{\begin{pmatrix} #1 \end{pmatrix}}
\newcommand{\eigmax}[1]{\rho(#1)}
\newcommand{\eigrealmax}[1]{\rho^+(#1)}
\newcommand{\spectrum}[1]{\Lambda(#1)}

% Linear dynamical systems.
\newcommand{\obsvmtx}{L_o}
\newcommand{\obsvgram}{W_o}
\newcommand{\ctrbmtx}{L_c}
\newcommand{\ctrbgram}{W_c}

% Topology.
\newcommand{\interior}[1]{\operatorname{int} #1}

% Calculus / analysis.
\newcommand{\partialby}[1]{\frac{\partial}{\partial #1}}
\newcommand{\Lip}[1]{\mathrm{Lip}(#1)}
\renewcommand{\d}{\mathrm{d}}
\newcommand{\upto}{\nearrow}
\newcommand{\downto}{\searrow}

% Optimization.
\DeclareMathOperator*{\argmax}{argmax\ }
\DeclareMathOperator*{\argmin}{argmin\ }
\DeclareMathOperator*{\find}{find}
\DeclareMathOperator*{\minimize}{minimize\ }
\DeclareMathOperator*{\maximize}{maximize\ }
\DeclareMathOperator{\OPT}{OPT}
\DeclareMathOperator{\const}{const.}
\DeclareMathOperator{\epi}{\mathbf{epi}}
\newcommand{\subgradients}[2]{\delta #1 (#2)}
\DeclareMathOperator{\prox}{\mathbf{prox}}
\newcommand{\hessian}[1]{\nabla_{\! #1\, #1}}
\renewcommand{\gradient}[1]{\nabla_{\! #1}}  % TODO: which package defined this? it's too heavy
\newcommand{\gradienthat}[1]{\hat{\nabla}_{\! #1}}

% Geometry.
\DeclareMathOperator{\conv}{conv}
\DeclareMathOperator{\ext}{ext}
\DeclareMathOperator{\vol}{vol}

% Probability distributions.
\DeclareMathOperator{\Normal}{\mathcal{N}}
\DeclareMathOperator{\Binomial}{Binomial}
\DeclareMathOperator{\Uniform}{Uniform}
\DeclareMathOperator{\Beta}{Beta}

% Other probability stuff.
\DeclareMathOperator*{\E}{\mathbb{E}}
\newcommand{\iid}{\mathrm{iid}}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\newcommand{\simplex}[1]{\triangle(#1)} % TODO: how to make it use \left( \right) without a preceding space?
\newcommand{\Indicator}[1]{\I_{#1}}
\newcommand{\IndicatorPred}[1]{\I_{[#1]}}
\newcommand{\IndicatorSet}[1]{\I_{\{#1\}}}
\newcommand{\cond}{\;\middle\vert\;}
\newcommand{\DKL}{D_{\mathrm{KL}}}
\newcommand{\TV}{\mathrm{TV}}
\renewcommand{\wp}{\mathrm{w.p.\ }}
\newcommand{\whp}{\mathrm{w.h.p.\ }}

% Learning stuff.
\DeclareMathOperator{\Rad}{R}
\DeclareMathOperator{\VCdim}{VCdim}
\DeclareMathOperator{\Ldim}{Ldim}
\DeclareMathOperator{\Reg}{Reg}
\DeclareMathOperator{\BReg}{BReg}
\DeclareMathOperator{\pReg}{\overline{Reg}}
\DeclareMathOperator{\fat}{fat}
\DeclareMathOperator{\sfat}{sfat}
\DeclareMathOperator{\UCB}{UCB}
\DeclareMathOperator{\relu}{relu}

% Control stuff.
\newcommand{\Laplace}{\cL}

% CS, complexity, etc.
\DeclareMathOperator{\poly}{poly}
\DeclareMathOperator{\polylog}{polylog}

% Miscellaneous.
\renewcommand{\th}{^{\mathrm{th}}}
\DeclareMathOperator{\clip}{clip}
\DeclareMathOperator{\rclip}{rclip} % ratio clip
\DeclareMathOperator{\sign}{sign}
\newcommand{\eps}{\varepsilon}
\newcommand{\nofrac}[2]{\left. #1 \middle/ #2 \right.} % to easily switch between frac, nicefrac, and plain old num / denom
\newcommand{\defeq}{\triangleq}  % in case we decide to use := or something
\newcommand{\qeq}{\stackrel{?}{=}}
\newcommand{\old}{\mathrm{old}}
\newcommand{\new}{\mathrm{new}}
